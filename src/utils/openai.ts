// Интерфейс для запроса к OpenAI API
export interface OpenAIRequest {
  model: string;
  messages: {
    role: 'system' | 'user' | 'assistant';
    content: string;
  }[];
  temperature?: number;
  max_tokens?: number;
}

// Интерфейс для ответа от OpenAI API
export interface OpenAIResponse {
  id: string;
  object: string;
  created: number;
  model: string;
  choices: {
    index: number;
    message: {
      role: string;
      content: string;
    };
    finish_reason: string;
  }[];
  usage: {
    prompt_tokens: number;
    completion_tokens: number;
    total_tokens: number;
  };
}

// Функция для отправки запроса к OpenAI API
export async function callOpenAI(
  messages: { role: 'system' | 'user' | 'assistant'; content: string }[],
  options: { temperature?: number; max_tokens?: number } = {}
): Promise<string> {
  // В реальном приложении здесь будет запрос к API
  // Для демонстрации используем заглушку

  try {
    // Проверяем последнее сообщение пользователя
    const lastUserMessage = messages
      .filter(msg => msg.role === 'user')
      .pop()?.content.toLowerCase() || '';

    // Имитация ответа от OpenAI
  if (lastUserMessage.includes('привет') || lastUserMessage.includes('здравствуй')) {
    return 'Привет! Я твой ИИ-ассистент для подготовки к экзаменам. Чем я могу помочь тебе сегодня?';
  } else if (lastUserMessage.includes('математик') || lastUserMessage.includes('алгебр') || lastUserMessage.includes('геометри')) {
    return `Математика - отличный предмет для изучения! Я могу помочь тебе с различными темами:

1. **Алгебра**: уравнения, неравенства, функции, графики
2. **Геометрия**: планиметрия, стереометрия, векторы
3. **Математический анализ**: пределы, производные, интегралы

Какая конкретная тема тебя интересует?`;
  } else if (lastUserMessage.includes('уравнен')) {
    return `Уравнения - важная тема в математике. Вот основные типы уравнений:

1. **Линейные уравнения**: ax + b = 0
2. **Квадратные уравнения**: ax² + bx + c = 0
3. **Кубические уравнения**: ax³ + bx² + cx + d = 0
4. **Системы уравнений**

Для квадратных уравнений используется формула: x = (-b ± √(b² - 4ac)) / 2a

Хочешь разобрать конкретный пример?`;
  } else if (lastUserMessage.includes('производн')) {
    return `Производная функции f(x) - это скорость изменения функции в точке x.

Основные правила дифференцирования:
1. (C)' = 0, где C - константа
2. (x^n)' = n·x^(n-1)
3. (f(x) + g(x))' = f'(x) + g'(x)
4. (f(x) · g(x))' = f'(x) · g(x) + f(x) · g'(x)
5. (f(g(x)))' = f'(g(x)) · g'(x)

Примеры:
- (x²)' = 2x
- (sin x)' = cos x
- (e^x)' = e^x

Нужны дополнительные примеры или объяснения?`;
  } else if (lastUserMessage.includes('русск') || lastUserMessage.includes('язык') || lastUserMessage.includes('литератур')) {
    return `Русский язык и литература - фундаментальные предметы. Я могу помочь с:

1. **Орфография**: правила написания слов
2. **Пунктуация**: правила расстановки знаков препинания
3. **Морфология**: части речи и их формы
4. **Синтаксис**: строение предложений
5. **Анализ литературных произведений**

Какой аспект тебя интересует больше всего?`;
  } else if (lastUserMessage.includes('тест') || lastUserMessage.includes('экзамен')) {
    return `Подготовка к тестам и экзаменам требует системного подхода. Вот несколько рекомендаций:

1. **Составь план подготовки** с разбивкой по темам и датам
2. **Регулярно повторяй** пройденный материал
3. **Решай практические задания** и тесты прошлых лет
4. **Выделяй сложные темы** и уделяй им больше внимания
5. **Используй разные источники** информации

Я могу помочь тебе с конкретными вопросами по предметам или с составлением плана подготовки. Что тебя интересует?`;
  } else {
    return `Спасибо за вопрос! Я могу помочь тебе с подготовкой к экзаменам по различным предметам:

1. **Математика**: алгебра, геометрия, математический анализ
2. **Физика**: механика, электричество, оптика
3. **Химия**: неорганическая и органическая химия
4. **Биология**: анатомия, генетика, экология
5. **История**: отечественная и мировая история
6. **Русский язык и литература**
7. **Иностранные языки**

Также я могу помочь с методиками обучения, составлением плана подготовки и мотивацией. Уточни, пожалуйста, какой предмет или тема тебя интересует?`;
  }
  } catch (error) {
    console.error('Ошибка при обработке запроса к OpenAI:', error);
    return 'Извините, произошла ошибка при обработке вашего запроса. Пожалуйста, попробуйте еще раз.';
  }
}

// Системное сообщение для ИИ-ассистента
export const ASSISTANT_SYSTEM_MESSAGE = `Ты - ИИ-ассистент для подготовки к экзаменам, специализирующийся на помощи студентам в обучении.
Твоя задача - давать точные, понятные и полезные ответы на вопросы по различным предметам.
Ты должен быть дружелюбным, поддерживающим и мотивирующим.
Если ты не знаешь ответ, честно признайся в этом и предложи альтернативные ресурсы.
Старайся структурировать ответы, используя списки, выделение важных моментов и примеры.
Ты можешь помогать с математикой, физикой, химией, биологией, историей, языками и другими предметами школьной и университетской программы.`;
