# Руководство по развертыванию

Это руководство описывает процесс развертывания приложения Study Assistant в различных средах.

## Содержание

1. [Требования](#требования)
2. [Локальное развертывание](#локальное-развертывание)
3. [Развертывание на Vercel](#развертывание-на-vercel)
4. [Настройка Supabase](#настройка-supabase)
5. [Настройка CI/CD](#настройка-cicd)
6. [Мониторинг и логирование](#мониторинг-и-логирование)
7. [Масштабирование](#масштабирование)
8. [Резервное копирование](#резервное-копирование)

## Требования

Для развертывания приложения необходимы следующие компоненты:

- Node.js 18.x или выше
- npm 9.x или выше
- Git
- Аккаунт на Vercel (для продакшн-развертывания)
- Аккаунт на Supabase (для базы данных и аутентификации)
- Аккаунт на Sentry (для мониторинга ошибок)

## Локальное развертывание

### Клонирование репозитория

```bash
git clone https://github.com/trolebumba/study-assistant-app.git
cd study-assistant-app
```

### Установка зависимостей

```bash
npm install
```

### Настройка переменных окружения

Создайте файл `.env.local` в корне проекта со следующим содержимым:

```
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-supabase-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key

# Sentry
NEXT_PUBLIC_SENTRY_DSN=your-sentry-dsn

# OpenAI (опционально)
OPENAI_API_KEY=your-openai-api-key

# Базовый URL
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

### Запуск приложения в режиме разработки

```bash
npm run dev
```

Приложение будет доступно по адресу [http://localhost:3000](http://localhost:3000).

### Сборка для продакшн

```bash
npm run build
```

### Запуск продакшн-версии

```bash
npm run start
```

## Развертывание на Vercel

### Подготовка к развертыванию

1. Создайте аккаунт на [Vercel](https://vercel.com) (если у вас его еще нет).
2. Установите Vercel CLI:

```bash
npm install -g vercel
```

3. Авторизуйтесь в Vercel CLI:

```bash
vercel login
```

### Развертывание

#### Вариант 1: Через Vercel CLI

```bash
vercel
```

Следуйте инструкциям в командной строке для настройки проекта.

#### Вариант 2: Через GitHub

1. Создайте репозиторий на GitHub и загрузите код:

```bash
git remote add origin https://github.com/your-username/study-assistant-app.git
git push -u origin main
```

2. Перейдите на [Vercel Dashboard](https://vercel.com/dashboard).
3. Нажмите "New Project".
4. Выберите репозиторий с вашим проектом.
5. Настройте переменные окружения (те же, что и в файле `.env.local`).
6. Нажмите "Deploy".

### Настройка домена

1. Перейдите в настройки проекта на Vercel.
2. Выберите вкладку "Domains".
3. Добавьте свой домен и следуйте инструкциям для настройки DNS.

## Настройка Supabase

### Создание проекта

1. Создайте аккаунт на [Supabase](https://supabase.com) (если у вас его еще нет).
2. Создайте новый проект.
3. Запишите URL проекта и анонимный ключ (они понадобятся для переменных окружения).

### Настройка базы данных

1. Перейдите в раздел "SQL Editor" в панели управления Supabase.
2. Выполните SQL-скрипт из файла `docs/database_schema.sql`:

```sql
-- Скопируйте содержимое файла database_schema.sql и выполните его
```

### Настройка аутентификации

1. Перейдите в раздел "Authentication" в панели управления Supabase.
2. Настройте провайдеры аутентификации (Email, Google, GitHub и т.д.).
3. Настройте шаблоны электронных писем для подтверждения регистрации и сброса пароля.

## Настройка CI/CD

### GitHub Actions

В проекте уже настроен GitHub Actions для непрерывной интеграции и доставки. Конфигурация находится в файле `.github/workflows/ci.yml`.

При каждом пуше в ветку `main` выполняются следующие действия:

1. Установка зависимостей
2. Линтинг кода
3. Запуск тестов
4. Сборка проекта
5. Деплой на Vercel (если все предыдущие шаги успешны)

### Настройка секретов GitHub

Для работы CI/CD необходимо настроить секреты в репозитории GitHub:

1. Перейдите в настройки репозитория на GitHub.
2. Выберите "Secrets and variables" -> "Actions".
3. Добавьте следующие секреты:
   - `VERCEL_TOKEN`: токен API Vercel
   - `VERCEL_ORG_ID`: ID организации Vercel
   - `VERCEL_PROJECT_ID`: ID проекта Vercel
   - `NEXT_PUBLIC_SUPABASE_URL`: URL проекта Supabase
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`: анонимный ключ Supabase
   - `NEXT_PUBLIC_SENTRY_DSN`: DSN Sentry

## Мониторинг и логирование

### Sentry

В проекте настроен Sentry для мониторинга ошибок. Конфигурация находится в файлах:
- `sentry.client.config.js`
- `sentry.server.config.js`
- `sentry.edge.config.js`

Для настройки Sentry:

1. Создайте аккаунт на [Sentry](https://sentry.io) (если у вас его еще нет).
2. Создайте новый проект для JavaScript/Next.js.
3. Запишите DSN проекта (он понадобится для переменных окружения).

### Umami Analytics

Для аналитики без нарушения конфиденциальности в проекте используется Umami:

1. Разверните Umami согласно [официальной документации](https://umami.is/docs/install).
2. Добавьте скрипт Umami в компонент `src/components/analytics/UmamiAnalytics.tsx`.

## Масштабирование

### Vercel

Vercel автоматически масштабирует приложение в зависимости от нагрузки. Дополнительная настройка не требуется.

### Supabase

Для масштабирования базы данных:

1. Перейдите в настройки проекта на Supabase.
2. Выберите подходящий тарифный план в зависимости от ожидаемой нагрузки.
3. Настройте пулы соединений и кэширование для оптимальной производительности.

## Резервное копирование

### База данных

Для резервного копирования базы данных Supabase:

1. Перейдите в раздел "Database" в панели управления Supabase.
2. Выберите "Backups".
3. Настройте расписание автоматических резервных копий.
4. Для ручного создания резервной копии нажмите "Create Backup".

### Файлы

Все файлы проекта хранятся в репозитории GitHub, который служит резервной копией кода.

Для дополнительного резервного копирования можно настроить автоматическое зеркалирование репозитория на другой платформе (например, GitLab или Bitbucket).
